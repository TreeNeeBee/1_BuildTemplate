set ( LOCAL_LIBRARY_DIR ${CMAKE_CURRENT_LIST_DIR} )

if ( ENABLE_BUILD_EXECUTABLE )
    # env
    string ( TOLOWER ${MODULE_NAME} LOWER_MODULE_NAME )
    if ( ENABLE_BUILD_WITH_PLATFORM_PREX )
        set ( LOCAL_EXECUTE_NAME ${PLATFORM_SYSTEM_TARGET}_${LOWER_MODULE_NAME} )
    else ()
        set ( LOCAL_EXECUTE_NAME ${LOWER_MODULE_NAME} )
    endif ()
    set ( LOCAL_EXECUTE_VERNO ${MODULE_VERNO} )
    string ( REPLACE "." ";" LIST_EXECUTE_VERNO ${LOCAL_EXECUTE_VERNO} )
    list ( GET LIST_EXECUTE_VERNO 0 SUB_EXECUTE_SOVERNO )
    set ( BUILD_EXECUTE_SOVERNO ${SUB_EXECUTE_SOVERNO} )

    # source
    # c
    if ( DEFINED MODULE_SOURCE_C_DIR )
        file ( GLOB_RECURSE LOCAL_EXECUTE_C_HEADERS CONFIGURE_DEPENDS ${MODULE_SOURCE_C_DIR}/*.h )
        file ( GLOB_RECURSE LOCAL_EXECUTE_C_SOURCES CONFIGURE_DEPENDS ${MODULE_SOURCE_C_DIR}/*.c )
    endif()

    # c++
    if ( DEFINED MODULE_SOURCE_CXX_DIR )
        file ( GLOB_RECURSE LOCAL_EXECUTE_CXX_HEADERS CONFIGURE_DEPENDS ${MODULE_SOURCE_CXX_DIR}/*.h* )
        file ( GLOB_RECURSE LOCAL_EXECUTE_CXX_SOURCES CONFIGURE_DEPENDS ${MODULE_SOURCE_CXX_DIR}/*.c* )
    endif()
    #message ( WARNING ${LOCAL_EXECUTE_C_HEADERS} ${LOCAL_EXECUTE_C_SOURCES} )
    #message ( WARNING ${LOCAL_EXECUTE_CXX_HEADERS} ${LOCAL_EXECUTE_CXX_SOURCES} )

    set ( LOCAL_EXECUTE_INCLUDE_DIRS "" )
    foreach ( _headerFile ${LOCAL_EXECUTE_C_HEADERS} )
        get_filename_component( _dir ${_headerFile} PATH )
        list ( APPEND LOCAL_EXECUTE_INCLUDE_DIRS ${_dir} )
    endforeach()
    foreach ( _headerFile ${LOCAL_EXECUTE_CXX_HEADERS} )
        get_filename_component( _dir ${_headerFile} PATH )
        list ( APPEND LOCAL_EXECUTE_INCLUDE_DIRS ${_dir} )
    endforeach()
    list ( APPEND LOCAL_EXECUTE_INCLUDE_DIRS ${CMAKE_CURRENT_BINARY_DIR} )
    list ( APPEND LOCAL_EXECUTE_INCLUDE_DIRS ${MODULE_EXTERNAL_INCLUDE_DIR} )
    list ( REMOVE_DUPLICATES LOCAL_EXECUTE_INCLUDE_DIRS )
    #message ( WARNING ${LOCAL_EXECUTE_INCLUDE_DIRS} )

    # build
    add_executable ( ${LOCAL_EXECUTE_NAME} ${LOCAL_EXECUTE_C_SOURCES} ${LOCAL_EXECUTE_CXX_SOURCES} )

    set_target_properties ( ${LOCAL_EXECUTE_NAME} PROPERTIES VERSION ${LOCAL_EXECUTE_VERNO} SOVERSION ${BUILD_EXECUTE_SOVERNO} )
    if ( BUILD_WITH_STRIP )
        set_target_properties ( ${LOCAL_EXECUTE_NAME} PROPERTIES LINK_FLAGS_RELEASE -s )
    endif ()

    include_directories ( ${SDK_INCLUDE_DIR} ${LOCAL_EXECUTE_INCLUDE_DIRS} )
    link_directories ( ${SDK_LIB_DIR} ${CMAKE_CURRENT_BINARY_DIR} )
    #message ( WARNING ${SDK_INCLUDE_DIR} ${SDK_LIB_DIR} )

    #target_include_directories ( ${LOCAL_EXECUTE_NAME} PRIVATE ${SDK_INCLUDE_DIR} ${LOCAL_EXECUTE_NAME} PRIVATE ${LOCAL_EXECUTE_INCLUDE_DIRS} )

    target_link_directories( ${LOCAL_EXECUTE_NAME} PRIVATE ${SDK_LIB_DIR} 
                                ${LOCAL_EXECUTE_NAME} PRIVATE ${CMAKE_CURRENT_BINARY_DIR} )
    target_link_libraries ( ${LOCAL_EXECUTE_NAME} PRIVATE ${MODULE_EXTERNAL_LIB} )

    # install
    set ( LOCAL_INSTALL_INC_DIR ${INSTALL_INC_ROOT_DIR}/${LOWER_MODULE_NAME} )
    set ( LOCAL_INSTALL_EXECUTE_DIR ${INSTALL_EXECUTE_ROOT_DIR} )

    install ( TARGETS ${LOCAL_EXECUTE_NAME} LIBRARY DESTINATION ${LOCAL_INSTALL_EXECUTE_DIR} )

    if ( DEFINED MODULE_INSTALL_SRC_DIR )
        install ( DIRECTORY ${MODULE_INSTALL_SRC_DIR} DESTINATION ${LOCAL_INSTALL_INC_DIR} )
    else ()
        install ( DIRECTORY ${MODULE_SOURCE_DIR}/inc/ DESTINATION ${LOCAL_INSTALL_INC_DIR} )
    endif ()
endif ()
